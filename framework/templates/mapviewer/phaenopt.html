<!DOCTYPE html>
<html lang="en" ng-app="webgisApp" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">
    <title>PhaenOPT Portal - Webdienst für das phänologische Klimafolgenmonitoring</title>

    <link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'>

    {% load staticfiles %}
    {% load assets %}
    {% assets "swosVendorCssBundle" %}
    <link href="{{ ASSET_URL }}" rel="stylesheet" />
    {% endassets %}

    {% assets "geossVendorCssBundle" %}
    <link href="{{ ASSET_URL }}" rel="stylesheet" />
    {% endassets %}

    {# requires fonts and css to be in the same directory, so no inclusion in bundle #}
    <link href="{% static "img/flaticon/font/flaticon.css" %}" rel="stylesheet" />

    {% assets "swosAppCssBundle" %}
    <link href="{{ ASSET_URL }}" rel="stylesheet" />
    {% endassets %}

    {% verbatim %}
    <script type="text/ng-template" id="close">
        <div class="triangle"></div>
        <div class="ns-popover-tooltip" ng-bind="layer.title">
            <button ng-click="hidePopover()">Close</button>
        </div>
    </script>
    {% endverbatim %}

    <script type="text/javascript">
        var mapId = {{id}};
        var subdir = '{{subdir}}';
    </script>


    <script type="text/javascript">
        var _paq = _paq || [];
        // add individual tracking code
    </script>

    <style type="text/css">
        #geoss-search-widget .rating-icon, #geoss-search-widget .rating {
            display:none;
        }
    </style>

    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
    <script>
    window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#3c404d",
          "text": "#d6d6d6"
        },
        "button": {
          "background": "#8bed4f"
        }
      },
      "position": "bottom-left",
      "content": {
        "href": "http://www.jena-optronik.de/en/imprint-data-privacy.html"
      }
    })});
    </script>
</head>
<body>
    <div ng-controller="StoryLineCtrl"></div>
    <div id="loading-div">
        <div class="loading">
            <i class="fa fa-circle-o-notch fa-spin"></i>
            <button class="btn btn-default btn-primary btn-sm" onclick="$('#loading-div').hide()" style="margin-left: -18px;margin-top: -65px;">... loading...</button>
        </div>
    </div>

    {% verbatim %}
    <div id="alerts" ng-controller="AlertCtrl as ac">
        <div uib-alert ng-repeat="alert in ac.alerts" class="alert alert-{{alert.type}}" close="ac.closeAlert()">{{alert.msg}}</div>
    </div>
    {% endverbatim %}

    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <div class="navbar-brand" id="title-left" style="padding-top: 4px;padding-left: 4px;"><a href="1.html"><img src="/static/tlug-logo.png" style="height: 50px;margin-top: 5px;"></a></div>
            </div>

            <!-- TOOLBAR in Navigation fuer Tablet und Desktop -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav pull-right col-md-3" id="nav-top-right" ng-controller="LoginCtrl as lc" style="padding-right:0;">
                    <li>
                        <div style="margin-top: 2px;font-size: 0.8em;padding-left: 5px;" class="partners">
                            Entwickelt und bereitgestellt durch:<br>
                            <a href="http://www.eo.uni-jena.de" target="_blank"><img src="/static/img/UniJena_BildWortMarke_blue.jpg" border="0" height="30"></a>
<a href="http://www.tlug-jena.de" target="_blank"><img src="/static/tlug-logo.png" border="0" height="30"></a>
                            <a href="http://www.jena-optronik.de" target="_blank"><img src="/static/jop-logo.png" height="28"></a>
                        </div>
                    </li>
                    <li class="dropdown btn-group pull-right" ng-include="'{% static "includes/auth.html" %}'" id="login-icon" style="display:none"></li>
                </ul>
                <ul class="nav navbar-nav pull-right" id="nav-top-right2">
                    <li class="dropdown btn-group  pull-right" ng-include="'{% static "includes/settings.html" %}'" style="width:50px;"></li>
                    <li class="dropdown btn-group  pull-right" ng-include="'{% static "includes/info_swos.html" %}'"></li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </div>
    </nav>

    {% verbatim %}
    <!-- NAVBAR SEARCH SMARTPHONE - Zweite Version, die auf dem Smartphone in einer separaten Zeile angezeigt wird.-->
    <nav class="navbar visible-xs" role="navigation" id="navbar-search" ng-controller="SearchBoxCtrl as sb">
        <div class="container-fluid">
          <!--  <form class="navbar-form navbar-right" ng-submit="sb.search();" role="search" id="xs-search">
                <div class="form-group">
                    <input type="text" class="form-control" ng-model="sb.text" placeholder="Search">
                </div>
            </form>-->
            <button class="btn btn-primary" type="submit"  id="toggle-sidebar">Menu</button>
        </div>
    </nav><!-- END NAVBAR SEARCH SMARTPHONE -->

    <!-- NAVBAR END -->

    <div class="container-fluid" id="center">
        <div class="row" ng-controller="MapCurrentLayersCtrl as mcl">
            <div ng-controller="MapViewerCtrl as mv">
                <div class="map-controls-wrapper">

                    <div id="wetland_sites" class="" style="color: black;font-weight: bold;text-align: center;float: left;margin-top: -4px;">
                        PhaenOPT.org<br>Webdienst für das phänologische Klimafolgenmonitoring
                    </div>

                    <div class="input-group hidden-xs hidden-sm" id="map_search" ng-controller="SearchBoxCtrl as sb">
                        <form ng-submit="sb.search_es();">
                            <input type="text" ng-model="sb.text" class="form-control" placeholder="Search for ..."
                                   id="search_desktop" autocomplete="off" ng-focus="mv.expandSearchBox()">
                            <br style="clear:both"/>
                            <div id="search-extend">
                                <button class="btn btn-primary" type="submit" style="float: right; margin: 4px auto;">
                                    Search
                                </button>
                                <br style="clear:both;"/>
                            </div>

                        </form>
                    </div>

                <!-- /input-group -->
                </div>

                <div class="col-sm-9 col-md-9 col-xs-12 main" map-openlayers id="map">

                    <div id="wetland_attribution">
                        <span ng-repeat="attribution in mv.layer_attribution">
                            | &copy;
                            <span ng-repeat="textpart in attribution">
                                <a ng-if="textpart.url" href="{{ textpart.url }}" target="_blank" style="text-decoration-line: underline; color: #d6d6d6;">{{ textpart.text }}</a>
                                <span ng-if="!textpart.url">{{ textpart.text }}</span>
                            </span>
                        </span>
                    </div>

                    <div id="map_icons">
                        <button type="button" uib-tooltip="Zoom in" tooltip-placement="bottom" tooltip-append-to-body="true" ng-click="mv.zoomIn()" class="btn btn-default btn-circle hidden-xs" id="zoomInButton"><i
                                class="fa-plus fa fa-lg"></i></button>
                        <button type="button" uib-tooltip="Zoom out" tooltip-placement="bottom" tooltip-append-to-body="true" ng-click="mv.zoomOut()" class="btn btn-default btn-circle hidden-xs" id="zoomOutButton"><i
                                class="fa-minus fa fa-lg"></i></button>
                        <button type="button" uib-tooltip="Zoom to initial extent" tooltip-placement="bottom" tooltip-append-to-body="true" ng-click="mv.zoomMaxExtent()" class="btn btn-default btn-circle"><i
                                class="fa-globe fa fa-lg"></i></button>
                        <!--<button type="button" ng-click="mv.createFeature()" class="btn btn-default btn-circle hidden-xs"><i class="fa-pencil-square-o fa fa-lg"></i></button>-->
                        <button type="button" uib-tooltip="Activate to request information (click on map)" tooltip-placement="bottom" tooltip-append-to-body="true" ng-click="mv.requestInfo()" ng-class="{'btn-active': mv.infoStatus}" ng-disabled="!mv.data.canRequestFeatureInfo" class="btn btn-default btn-circle hidden-xs"><i class="fa-info fa fa-lg"></i></button>
                        <button type="button" uib-tooltip="Show layer attribution" tooltip-placement="bottom" tooltip-append-to-body="true" ng-click="mv.showAttribution()"
                                class="btn btn-default btn-circle attributions-button" ng-disabled="mv.layer_attribution == false || mv.layer_attribution == undefined"><i class="fa-copyright fa fa-lg"></i></button>
                    </div>

                    <div class="remove-button-wrapper hidden-xs" style="display:none">
                        <button class="btn btn-default btn-sm" ng-click="mv.removeAllLayers()">
                            <span class="glyphicon glyphicon-remove"></span>
                            Remove all layers
                        </button>
                    </div>

                    <div id="map_legend"></div>

                    <div id="slider" style="display:none">
                        <div class="input"><input type="text" /></div>
                    </div>
                </div>
            </div>
            <div class="layer-list">
                <div id="current" ng-show="mcl.wetlandListState">
                    <!-- List GROUP -->
                    <div class="list-group" dnd-list="mcl.layersMeta" dnd-drop="mcl.prepareIndex(index, item)">
                        <div class="list-group-item clearfix" ng-repeat="layer in mcl.layersMeta" dnd-draggable="layer"
                             dnd-moved="mcl.changeLayer($index)" dnd-effect-allowed="move" style="border-radius:0;">

                            <div class="catalog-item">
                                <div class="item_left" style="padding-top:12px;">
                                    <button tooltip-append-to-body="true" tooltip-placement="right"
                                            uib-tooltip="Hide layer"
                                            type="button" ng-click="mcl.changeVisibility(layer.id, $event)"
                                            ng-if="mcl.getVisibility(layer.id)" class="btn btn-default"
                                            style="padding: 0;border-color: white;"
                                            aria-label="Left Align"><i
                                            class="fa fa-eye fa-lg"></i></button>
                                    <button tooltip-append-to-body="true" tooltip-placement="right"
                                            uib-tooltip="Show layer"
                                            type="button" ng-click="mcl.changeVisibility(layer.id, $event)"
                                            ng-if="!mcl.getVisibility(layer.id)" class="btn btn-default"
                                            style="padding: 0;border-color: white;"
                                            aria-label="Left Align"><i
                                            class="fa fa-eye-slash fa-lg"></i></button>
                                </div>
                                <div class="item_catalog">
                                    <div class="layer-title-wrapper">
                                        <div tooltip-placement="bottom" uib-tooltip="Show/Hide details" class="glyphicon glyphicon-chevron-down" style="float: left; width: 0;padding-left: 0; padding-top: 20px" ng-click="mcl.toggleLayerControls(layer.id, $event)"></div>
                                        <div class="item_title" style="float: left;width:206px;padding-left: 20px;" ng-click="mcl.zoomToLayer(layer.id)" ng-bind="layer.title"></div>
                                        <div tooltip-placement="bottom" uib-tooltip="Remove layer" class="glyphicon glyphicon-remove" ng-click="mcl.removeLayer(layer.id, $index, layer.django_id)"></div>
                                        <div style="clear:both;"></div>
                                    </div>
                                    <div class="layer-control-wrapper" ng-class="layer.id" style="display: none;margin-left:-14px;width:260px;border-top:1px solid #ddd; padding: 5px 10px;">
                                        <div class="item_desc">
                                            <slider class="slider" ng-model="mcl.sliderValues[layer.id]" min="0" max="100" step="1" on-slide="mcl.changeOpacity(layer.id)" on-stop-slide="mcl.changeOpacity(layer.id)" style="width:95%;"></slider>
                                            <div ng-if="layer.ogc_times">Specify date: <select ng-model="mcl.selectedLayerDates[layer.id]" ng-change="mcl.updateLayer(layer.id)" ng-options="o as o for o in layer.ogc_times"></select></div>
                                            <div ng-if="layer.layers">Specify layer: <select ng-model="mcl.selectedLayerNames[layer.id]" ng-change="mcl.updateLayerName(layer.id)" ng-options="o as o for o in layer.layers"></select></div>
                                        </div>
                                        <div class="item_icon" ng-if="layer.source != 'sentinelhub'">
                                            <button tooltip-placement="bottom" uib-tooltip="Show/Hide legend" type="button" ng-if="layer.legend_url || layer.legend_graphic || layer.legend_colors" ng-click="mcl.toggleLegend(layer)"  class="btn btn-default" aria-label="Left Align"><i class="fa fa-list fa-lg"></i></button>
<!--                                            <button tooltip-placement="bottom" uib-tooltip="Download data" ng-if="layer.downloadable" type="button" ng-click="mcl.download(layer)" class="btn btn-default" aria-label="Left Align"><i class="fa fa-download fa-lg"></i></button>-->
                                            <button tooltip-placement="bottom" uib-tooltip="Show metadata" type="button" ng-click="mcl.showMetadata(layer)" class="btn btn-default" aria-label="Left Align"><i class="fa fa-file-text-o fa-lg"></i></button>
                                            <button tooltip-placement="bottom" uib-tooltip="Show/Hide station list" type="button" ng-if="layer.ogc_type == 'SOS'" ng-click="mcl.toggleStations(layer)" class="btn btn-default" aria-label="Left Align"><i class="fa fa-list-ol fa-lg"></i></button>
                                            <button tooltip-placement="bottom" uib-tooltip="Zoom to layer" type="button" ng-click="mcl.zoomToLayer(layer.id)" class="btn btn-default" aria-label="Left Align"><i class="fa fa-search fa-lg"></i></button>
                                           <!-- <button tooltip-placement="bottom" uib-tooltip="Remove layer" type="button" ng-click="mcl.removeLayer(layer.id, $index, layer.django_id)" class="btn btn-default" aria-label="Left Align"><i class="fa fa-times fa-lg"></i></button>-->
                                        </div>
                                    </div>
                                </div>
                                <div class="layer-control-wrapper" ng-class="layer.id" style="display: none;">
                                    <div class="item_stations" ng-if="layer.ogc_type == 'SOS'" ng-hide="!layer.showStations">
                                        <strong>Available stations:</strong>
                                        <ul style="padding-left:20px;">
                                            <li ng-repeat="station in layer.stations"><a href="#" ng-click="mcl.zoomToStation(station);">{{ station.name }}
                                                ({{ station.lat.toFixed(2) }} {{ station.lon.toFixed(2) }})</a></li>
                                        </ul>
                                    </div>
                                    <div class="item_legend" style="margin-left:40px;margin-top:5px;" ng-if="layer.legend_url || layer.legend_graphic || layer.legend_colors" ng-hide="!layer.showLegend">
                                        <img ng-if="!layer.legend_colors && layer.legend_url" href="{{ layer.legend_url }}.jpg" ng-src="{{ layer.legend_url }}" alt="Layer legend" style="max-width:100%"/>
                                        <img ng-if="!layer.legend_colors && layer.legend_graphic && !layer.legend_url" ng-src="{{ layer.legend_graphic }}" alt="Layer legend" style="max-width:100%"/>
                                        <table ng-if="layer.legend_colors" style="border-collapse: separate; border-spacing: 0px 2px;">
                                            <tr ng-repeat="item in layer.legend_colors track by $index">
                                                <td ng-if="item['stroke-color'] != item.color && item['stroke-color']" class="legend-color legend-border-color"  ng-attr-style="background-color:{{ item.color }}; border-color: {{ item['stroke-color'] }};">&nbsp;</td>
                                                <td ng-if="item['stroke-color'] == item.color || !item['stroke-color']" class="legend-color"  ng-attr-style="background-color:{{ item.color }};">&nbsp;</td>
                                                <td class="legend-label">{{ item.label }}</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <!-- END List GROUP -->
                </div>
                <div id="active_layer" class="toggle-button-wrapper" ng-class="mcl.wetlandListState">
                    <button id="show_active_layer" class="glyphicon" ng-if="mcl.showToggleButton" ng-click="mcl.toggleWetlandList('click')"></button>
                </div>
            </div>

            <div class="col-md-3 sidebar first" id="sidebar" ng-controller="RegionsCtrl as regions">
                <!-- Tab panes -->

                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane" ng-class="{active: regions.data.activeTab==-1}" id="regions">
                        <div  ng-if="!regions.value['id']">
                            <div ng-if="regions.regions_without_geom.length==0">Loading regions... please wait </div>
                            <div ng-repeat="layer in regions.regions_without_geom" class="list-group-item clearfix" ng-click="regions.selectRegion(layer)" title="{{layer.name}}">
                                <div class="catalog-item">
                                    <div class="item_center">
                                        <div class="item_title">{{layer.name}}</div>
                                    </div>
                                    <div class="item_right">
                                        <button type="button" class="btn btn-default btn-xs button_catalog_meta" aria-label="Left Align" >
                                            <i class="fa fa-file-text-o fa-lg "></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="geospatial_data" ng-if="regions.value['id']" ng-class="{noImage: regions.value.data.image == null}" id="region_{{regions.value.id}}">
                            <div id="closeWetland" ng-click="regions.closeRegion()" style="float:right;color:white;cursor: pointer;margin-right: 5px;margin-top: 3px;display:none;">&#10060;</div>
                            <h2>{{regions.value.name}}</h2>
                            <div ng-if="regions.value.data.image!=null" class="wetland-image">
                                <a href="{{regions.value.data.image}}" class="fancybox" rel="wetland_{{regions.value.id}}" title="{{regions.value.data.image_desc}}">
                                    <img ng-src="{{regions.value.data.image}}" width="100%"/>
                                </a>
                                <div class="panoramio-wapi-tos wetland_image">
                                    <div class="desc">{{regions.value.data.image_desc}}</div>
                                </div>
                            </div>
                            <div ng-controller="StoryLineCtrl as storyline">
                            <div ng-controller="TrackingCtrl as tracking">
                                <uib-tabset justified="true">
                                    <!-- Overview -->
                                    <uib-tab class="flaticon-bars" heading="" uib-tooltip="Overview" tooltip-append-to-body="true" select="tracking.trackWetlandTab('overview')">

                                        <strong>Layers:</strong>
                                        <div class="select" ng-if="regions.value.data.layers.length > 0">
                                            <div ng-repeat="layer in regions.value.data.layers" id="layer_vis_div_{{layer.id}}">
                                                <input ng-if="regions.layerIdMap[layer.id] === undefined" type="checkbox" ng-click="regions.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}" />
                                                <input ng-if="regions.layerIdMap[layer.id]" type="checkbox" ng-click="regions.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}" checked="checked" />
                                                <label for="layer_vis_{{layer.id}}"> {{layer.alternate_title}}</label>
                                                <swos-layer-controls ng-if="regions.layers[regions.layerIdMap[layer.id]]" layer-hash="{{ regions.layerIdMap[layer.id] }}"></swos-layer-controls>
                                            </div>
                                        </div>

                                        <h4 style="margin-top:15px">Datasets and Services</h4>
                                        <div class="buttons" style="text-align: center;margin-top: 20px;">
                                            <button type="button" class="btn btn-wetland" onclick="$('li.flaticon-business a').click()">
                                                <div class="flaticon-business"></div>{{regions.dataCount.indicators}} Klimakarten</button>
                                            <button type="button" class="btn btn-wetland" onclick="$('li.flaticon-layers a').click()">
                                                <div class="flaticon-layers"></div>{{regions.dataCount.products}} Ph&auml;nologiekarten</button>
                                            <button type="button" class="btn btn-wetland" onclick="$('li.flaticon-space-satellite-station a').click()">
                                                <div class="flaticon-space-satellite-station"></div>{{regions.dataCount.satdata}} Satellitendaten</button>
                                            <button type="button" class="btn btn-wetland" onclick="$('li.flaticon-technology-1 a').click()">
                                                <div class="flaticon-technology-1"></div>{{regions.dataCount.images}} In-Situ Daten</button>
                                            <button type="button" class="btn btn-wetland" onclick="$('li.flaticon-technology a').click()">
                                                <div class="flaticon-technology"></div>{{regions.dataCount.videos}} Citizen Science</button>
                                            <button type="button" class="btn btn-wetland" onclick="$('li.flaticon-technology-2 a').click()">
                                                <div class="flaticon-technology-2"></div>{{regions.dataCount.externaldb}} Hintergrundkarten</button>
                                        </div>
                                    </uib-tab>

                                    <!-- Indicators -->
                                    <uib-tab class="flaticon-business" heading="" uib-tooltip="Klimakarten" tooltip-append-to-body="true" select="tracking.trackWetlandTab('indicator')">
                                        <div ng-if="regions.value.data.climatelayers.length == 0">No indicators available!</div>
                                        <div ng-if="regions.value.data.climatelayers.length > 0">

                                            <uib-accordion>
                                                <div uib-accordion-group ng-repeat="product in regions.value.data.climatelayers" heading="{{product.name}}" is-open="product.open">
                                                    <uib-accordion-heading ng-click="tracking.trackProduct(product.name, product.open);" >
                                                        {{product.name}}
                                                        <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': product.open, 'glyphicon-chevron-right': !product.open}"></i>
                                                    </uib-accordion-heading>

                                                    <div class="options">
                                                        <p ng-text-truncate='product.description' ng-tt-chars-threshold="200"></p>
                                                        <div class="products_datasets">

                                                            <strong>Layers:</strong>
                                                            <div class="select" ng-if="product.layers.length > 0">
                                                                <div ng-repeat="layer in product.layers" id="layer_vis_div_{{layer.id}}">
                                                                    <input ng-if="regions.layerIdMap[layer.id] === undefined" type="checkbox" ng-click="regions.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}" />
                                                                    <input ng-if="regions.layerIdMap[layer.id]" type="checkbox" ng-click="regions.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}" checked="checked" />
                                                                    <label for="layer_vis_{{layer.id}}"> {{layer.alternate_title}}</label>
                                                                    <swos-layer-controls ng-if="regions.layers[regions.layerIdMap[layer.id]]" layer-hash="{{ regions.layerIdMap[layer.id] }}"></swos-layer-controls>
                                                                </div>
                                                            </div>
                                                            <div class="select"
                                                                 ng-if="product.layers.length == 0">
                                                                No datasets available.
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </uib-accordion>
                                        </div>
                                    </uib-tab>

                                    <!-- Products -->
                                    <uib-tab class="flaticon-layers"  heading="" uib-tooltip="Products" tooltip-append-to-body="true"  select="tracking.trackWetlandTab('product')" id="product">
                                        <div ng-if="regions.value.data.phenolayers.length == 0">No phenolayers available!</div>
                                        <div>
                                        <ul class="items products">

                                            <uib-accordion close-others="false">
                                                <div uib-accordion-group ng-repeat="product in regions.value.data.phenolayers"  heading="{{product.name}}" is-open="product.open">
                                                    <uib-accordion-heading ng-click="tracking.trackProduct(product.name, product.open);">
                                                        {{product.name}}
                                                        <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': product.open, 'glyphicon-chevron-right': !product.open}"></i>
                                                    </uib-accordion-heading>
                                                    <div class="options">
                                                        <p ng-text-truncate='product.description' ng-tt-chars-threshold="200"></p>
                                                        <div class="products_datasets">
                                                            <strong>Layers:</strong>
                                                            <div class="select" ng-if="product.layers.length > 0">
                                                                <div ng-repeat="layer in product.layers" id="layer_vis_div_{{layer.id}}">
                                                                    <input ng-if="regions.layerIdMap[layer.id] === undefined" type="checkbox" ng-click="regions.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}" />
                                                                    <input ng-if="regions.layerIdMap[layer.id]" type="checkbox" ng-click="regions.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}" checked="checked" />
                                                                    <label for="layer_vis_{{layer.id}}"> {{layer.alternate_title}}</label>
                                                                    <swos-layer-controls ng-if="regions.layers[regions.layerIdMap[layer.id]]" layer-hash="{{ regions.layerIdMap[layer.id] }}"></swos-layer-controls>
                                                                </div>
                                                            </div>
                                                            <div class="select" ng-if="product.layers.length == 0">
                                                                No datasets available.
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </uib-accordion>
                                        </ul>
                                        </div>
                                    </uib-tab>

                                    <!-- Satellitendaten -->
                                    <uib-tab class="flaticon-space-satellite-station" heading="" uib-tooltip="Satellitendaten" tooltip-append-to-body="true"  select="tracking.trackWetlandTab('satdata')">
                                        <uib-accordion close-others="false">
                                            <div uib-accordion-group is-open="wetlands.satdata_image">
                                                <uib-accordion-heading>
                                                    Satellite scenes explorer
                                                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': wetlands.satdata_image, 'glyphicon-chevron-right': !wetlands.satdata_image}"></i>
                                                </uib-accordion-heading>
                                                <a href="javascript:;" uib-tooltip="Click to open the satellite scenes explorer application" ng-click="wetlands.showSatdataExplorer()"><img ng-src="/media/cache/satdata/satdata_all_{{wetlands.value.id}}_small.png" width="100%" /></a>
                                                <div class="last_update" style="text-align: right;font-size: 0.85em;">Last update: 2018-04-30</div>
                                            </div>
                                            <div uib-accordion-group is-open="wetlands.satdata_layers" ng-if="wetlands.value.satdata.layers_count > 0">
                                                <uib-accordion-heading>
                                                    Satellite scene layers
                                                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': wetlands.satdata_layers, 'glyphicon-chevron-right': !wetlands.satdata_layers}"></i>
                                                </uib-accordion-heading>
                                                <div uib-accordion-group ng-repeat="(key, layers) in wetlands.value.satdata.layers" ng-if="layers.length > 0">
                                                    <uib-accordion-heading>
                                                        {{key}}
                                                        <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': wetlands.satdata_layers, 'glyphicon-chevron-right': !wetlands.satdata_layers}"></i>
                                                    </uib-accordion-heading>
                                                    <div ng-repeat="layer in layers | orderObjectBy:'id'"
                                                         ng-controller="MapCurrentLayersCtrl as mcl" id="layer_vis_div_{{layer.id}}">
                                                        <input ng-if="wetlands.layerIdMap[layer.id] === undefined" type="checkbox" ng-click="wetlands.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}"/>
                                                        <input ng-if="wetlands.layerIdMap[layer.id]" type="checkbox" ng-click="wetlands.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}" checked="checked"/>
                                                        <label for="layer_vis_{{layer.id}}"> {{layer.alternate_title}}</label>
                                                        <swos-layer-controls ng-if="wetlands.layers[wetlands.layerIdMap[layer.id]]" layer-hash="{{ wetlands.layerIdMap[layer.id] }}"></swos-layer-controls>
                                                    </div>
                                                </div>
                                                <div style="margin-top:10px;margin-left:2px;">Made available based on <a href="https://sentinel-hub.com/" target="_blank">Sentinel Hub Services</a> and the ESA Open Science Earth Observation grant (No. <a href="https://earth.esa.int/web/guest/pi-community/search-results-and-projects/keyword-entry?IFRAME_SRC=%2Fpi%2Fesa%3Fts%3D1528463214378%26targetIFramePage%3D%252Fweb%252Fguest%252Fpi-community%252Fsearch-results-and-projects%252Fkeyword-entry%26topSelectedNavigationNodeId%3DSEARCH%26coordinates%3D%26sideNavigationType%3DSEARCH%26type%3D10%26toprint%3D-1%26token%3D%26addattribute%3Dfalse%26sideExpandedNavigationBoxId%3DprojectSearch%26id%3D36615%26caller%3D%25252Fpi%25252Fesa%25253Finstitute%25253D%252526itemsPerPage%25253D10%252526sideExpandedNavigationBoxId%25253DprojectSearch%252526displayMode%25253Dcenter%252526cmd%25253Dother%252526submissionid%25253D-1%252526showAll%25253Dtrue%252526topSelectedNavigationNodeId%25253DSEARCH%252526keyword%25253D%252526downloadAsCsv%25253Dfalse%252526targetIFramePage%25253D%2525252Fweb%2525252Fguest%2525252Fpi-community%2525252Fsearch-results-and-projects%2525252Fkeyword-entry%252526ts%25253D1528463214378%252526colorTheme%25253D03%252526startFrom%25253D0%252526sideNavigationType%25253DSEARCH%252526title%25253D%252526aoid%25253D1560%26cmd%3Dproject%26header%3D%26displayMode%3Dcenter%26colorTheme%3D03%26subnavigation%3D1%26role%3D0" target="_blank">36615</a>).</div>
                                                <div class="last_update" style="text-align: right;font-size: 0.85em;margin-top: 10px;margin-right: 5px;">Last update: 2018-04-30</div>
                                            </div>
                                            <div uib-accordion-group is-open="wetlands.satdata_table">
                                                <uib-accordion-heading>
                                                    Total amount by sensor
                                                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': wetlands.satdata_table, 'glyphicon-chevron-right': !wetlands.satdata_table}"></i>
                                                </uib-accordion-heading>
                                                <table class="table data">
                                                    <tr>
                                                        <!--<th>&nbsp;</th>-->
                                                        <th>Sensor</th>
                                                        <th>Scenes</th>
                                                        <th>Start</th>
                                                        <th>End</th>
                                                    </tr>
                                                    <tr ng-if="!wetlands.value.satdata">
                                                        <td colspan="4">Loading...</td>
                                                    </tr>
                                                    <tr ng-repeat="data in wetlands.value.satdata.table" >
                                                        <!--<td><input type="checkbox" id="layer_data_s2" /><label for="layer_data_s2"></label></td>-->
                                                        <td>{{data.dataset}}</td>
                                                        <td>{{data.count}}</td>
                                                        <td>{{data.min}}</td>
                                                        <td>{{data.max}}</td>
                                                    </tr>
                                                </table>
                                                <div class="last_update" style="text-align: right;font-size: 0.85em;">Last update: 2018-04-30</div>
                                            </div>
                                            <div uib-accordion-group is-open="wetlands.satdata_sources">
                                                <uib-accordion-heading>
                                                    Data sources
                                                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': wetlands.satdata_sources, 'glyphicon-chevron-right': !wetlands.satdata_sources}"></i>
                                                </uib-accordion-heading>
                                                <p>
                                                    <strong>Copernicus Open Access Hub</strong><br/>
                                                    Sentinel-1 A&B IW GRD data have been searched through the Copernicus Open Access Hub OpenSearch API. <br />
                                                    <a href="https://scihub.copernicus.eu" target="_blank">https://scihub.copernicus.eu</a>
                                                </p>
                                                <hr/>
                                                <p>
                                                    <strong>USGS Earth Explorer</strong><br/>
                                                    Landsat MSS, Landsat TM (Collection 1), Landsat ETM (Collection 1), Landsat-8 (Collection 1), Sentinel 2A data have been searched through the USGS Earth Explorer API. <br />
                                                    <a href="https://earthexplorer.usgs.gov" target="_blank">https://earthexplorer.usgs.gov</a>
                                                </p>
                                                <hr/>
                                                <p>
                                                    <strong>Sinergise Sentinel Hub Services</strong><br/>
                                                    Landsat TM and Landsat ETM data from ESA archives have been searched through the Sentinel Hub WFS Services. Furthermore WMS services for Landsat TM, Landsat ETM, Landsat 8 and Sentinel datasets have been integrated within the satellite scenes explorer for data visualization.<br />
                                                    <a href="http://sentinel-hub.com" target="_blank">http://sentinel-hub.com</a>
                                                </p>
                                            </div>
                                        </uib-accordion>
                                    </uib-tab>

                                    <!-- In-Situ-Daten -->
                                    <uib-tab class="flaticon-technology-1" heading="" uib-tooltip="In-Situ Daten" tooltip-append-to-body="true"  select="tracking.trackWetlandTab('in-situ')">
                                        <div ng-controller="InSituCtrl as insitu">
                                            <uib-accordion>
                                                <div uib-accordion-group is-open="insitu.stationOpen">
                                                    <uib-accordion-heading>Stationen (DWD)
                                                        <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': insitu.stationOpen, 'glyphicon-chevron-right': !insitu.stationOpen}"></i>
                                                    </uib-accordion-heading>
                                                    <div>
                                                        <select id="stations-selection" class="selectpicker" data-live-search="true" ng-model="insitu.selectedStation">
                                                          <option ng-repeat="station in insitu.stationen" value="{{ station }}">{{station.Stationsname}}</option>
                                                        </select>
                                                        <div ng-if="insitu.stationDataLoaded">
                                                            <p>
                                                                <strong>Lage: </strong>{{ insitu.selectedStationData['geograph_Breite'] }} {{ insitu.selectedStationData['geograph_Laenge'] }}<br/>
                                                                <strong>Höhe: </strong>{{ insitu.selectedStationData['Stationshoehe'] }} Meter<br/>
                                                                <strong>Naturraum: </strong>{{ insitu.selectedStationData['Naturraum'] }}
                                                                <span ng-if="insitu.selectedStationData['Stationsaufloesung']"><br/><strong>Stationsaufloesung: </strong>{{ insitu.selectedStationData['Stationsaufloesung'] }}</span>
                                                            </p>
                                                            <div ng-if="insitu.selectedStationData['phases'].length > 0">
                                                                <strong>Verfügbare Daten:</strong>
                                                                <select id="phases-selection" class="selectpicker" data-live-search="true" ng-model="insitu.selectedPhase">
                                                                  <option ng-repeat="phase in insitu.selectedStationData['phases']" value="{{ phase }}">{{ phase.name }}</option>
                                                                </select>
                                                                <img ng-src="{{ insitu.selectedPhaseImage }}" width="100%" />
                                                            </div>
                                                            <div ng-if="insitu.selectedStationData['phases'].length == 0">
                                                                Keine Daten verfügbar!
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div uib-accordion-group is-open="insitu.PhasenOpen">
                                                    <uib-accordion-heading>Phasen (DWD)
                                                        <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': insitu.PhasenOpen, 'glyphicon-chevron-right': !insitu.PhasenOpen}"></i>
                                                    </uib-accordion-heading>
                                                    <div>

                                                    </div>
                                                </div>
                                            </uib-accordion>
                                        </div>
                                    </uib-tab>

                                    <!-- Citizen Science -->
                                    <uib-tab class="flaticon-technology" heading="" uib-tooltip="Citizen Science" tooltip-append-to-body="true"  select="tracking.trackWetlandTab('citizenscience')">
                                        <div ng-controller="CitizenScienceCtrl as citizenscience">
                                            <uib-accordion>
                                                <div uib-accordion-group ng-repeat="project in regions.value.data.citizenscience"  is-open="project.open">
                                                    <uib-accordion-heading>{{ project.name }}
                                                        <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': project.open, 'glyphicon-chevron-right': !project.open}"></i>
                                                    </uib-accordion-heading>
                                                    <div>
                                                        <p ng-text-truncate='project.description' ng-tt-chars-threshold="200"></p>
                                                        <div ng-if="citizenscience.data[project.id].features.length > 0">
                                                            <table>
                                                                <tr>
                                                                    <th>Datum</th>
                                                                    <th>Baum</th>
                                                                    <th>Phase</th>
                                                                    <th>Bild</th>
                                                                </tr>
                                                                <tr ng-repeat="feature in citizenscience.data[project.id].features">
                                                                    <td>{{ feature.properties.pubdate | date:'dd.MM.yyyy HH:mm' }}</td>
                                                                    <td>{{ feature.properties.baum }}</td>
                                                                    <td>{{ feature.properties.phase }}</td>
                                                                    <td><a href="{{ feature.properties.image }}" ng-if="feature.properties.image">Link</a></td>
                                                                </tr>
                                                            </table>
                                                            <button ng-if="!citizenscience.data[project.id].allLoaded" type="button" class="btn btn-loadmore" ng-click="citizenscience.loadData(project.id, citizenscience.data[project.id].features.length)">Load more</button>
                                                        </div>
                                                    </div>
                                                </div>
                                        </div>
                                    </uib-tab>

                                    <!-- Hintergrundkarten -->
                                    <uib-tab class="flaticon-technology-2" heading="" uib-tooltip="Hintergrundkarten" tooltip-append-to-body="true" select="tracking.trackWetlandTab('backgroundmaps')">
                                        <div ng-if="wetlands.value.data.externaldb.length == 0">No external databases registered!</div>
                                        <div ng-if="wetlands.value.data.externaldb.length != 0"><!--{{ wetlands.value.data.externaldb.length }} external databases registered!-->
                                            <div ><input ng-model="wetlands.externaldb_search.searchText" placeholder="Search for ...">
                                                <input  type="checkbox" ng-model="wetlands.externaldb_search.layer_exist" id="only_layer">
                                                <label for="only_layer" style="margin-top: 8px;" >
                                                    <div class="flaticon-layers" style="display: inline-block;"></div> Filter by maps
                                                </label>
                                            </div>
                                        </div>

                                        <uib-accordion>
                                            <div uib-accordion-group ng-repeat="externaldb_group in wetlands.value.data.externaldb" is-open="externaldb_group.open">
                                                <uib-accordion-heading>
                                                    {{ externaldb_group.group }} ({{ (externaldb_group.datasets|filter: wetlands.externaldb_search.searchText | filter:externaldb.layer_exist = wetlands.externaldb_search.layer_exist ).length }})
                                                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': externaldb_group.open, 'glyphicon-chevron-right': !externaldb_group.open}"></i>
                                                </uib-accordion-heading>
                                                <uib-accordion>
                                                    <div uib-accordion-group  is-open="externaldb.open2" ng-repeat="externaldb in externaldb_group.datasets | filter:wetlands.externaldb_search.searchText | filter:externaldb.layer_exist = wetlands.externaldb_search.layer_exist " >
                                                        <uib-accordion-heading>
                                                            <div id=externaldb_{{externaldb.ext_db_id}}" ng-if="externaldb.layers.length > 0" class="flaticon-layers"> {{externaldb.name}}
                                                                <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': externaldb.open2, 'glyphicon-chevron-right': !externaldb.open2}"></i></div>
                                                            <div id="externaldb_{{externaldb.ext_db_id}}" ng-if="!externaldb.layers.length" class="flaticon-internet"> {{externaldb.name}}
                                                                <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': externaldb.open2, 'glyphicon-chevron-right': !externaldb.open2}"></i></div>
                                                        </uib-accordion-heading>
                                                        <p ng-text-truncate='externaldb.description' ng-tt-chars-threshold="200"></p>
                                                        <div ng-if="externaldb.provided_info"><strong>Provided data:</strong><p ng-text-truncate='externaldb.provided_info' ng-tt-chars-threshold="200"></p></div>
                                                        <strong>Link:</strong>
                                                        <div><p><a href="{{ externaldb.online_link }}" target="_blank">{{externaldb.online_link}}</a> <span ng-if="externaldb.language != 'en'">({{ externaldb.language }})</span></p></div>
                                                        <div class="geoss-btn" ng-if="externaldb.geoss_datasource_id">
                                                            <button class="btn btn-default btn-primary" style="cursor:pointer" ng-click="wetlands.externalDBSearchGeoss(externaldb.geoss_datasource_id, 'OVERLAPS')">Search with GEOSS</button>
                                                        </div>
                                                        <div class="select" ng-if="externaldb.layers.length > 0">
                                                            <strong>Layers:</strong>
                                                            <div ng-repeat="layer in externaldb.layers"
                                                                 ng-controller="MapCurrentLayersCtrl as mcl" id="layer_vis_div_{{layer.id}}">
                                                                <input ng-if="wetlands.layerIdMap[layer.id] === undefined" type="checkbox" ng-click="wetlands.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}"/>
                                                                <input ng-if="wetlands.layerIdMap[layer.id]" type="checkbox" ng-click="wetlands.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}" checked="checked"/>
                                                                <label for="layer_vis_{{layer.id}}"> {{layer.alternate_title}}</label>
                                                                <swos-layer-controls ng-if="wetlands.layers[wetlands.layerIdMap[layer.id]]" layer-hash="{{ wetlands.layerIdMap[layer.id] }}"></swos-layer-controls>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </uib-accordion>
                                            </div>
                                        </uib-accordion>
                                    </uib-tab>
                                </uib-tabset>
                            </div>
                                </div>
                        </div>
                    </div>

                    <div role="tabpanel" class="tab-pane national_data" id="national" ng-controller="NationalDataCtrl as nationalData">

                        <select id="contries-selection" class="selectpicker" data-live-search="true" ng-model="nationalData.selectedCountryName">
                          <option ng-repeat="country in nationalData.countries">{{country.name}}</option>
                        </select>

                        <uib-accordion close-others="false" ng-if="nationalData.selectedCountry != null">
                            <div uib-accordion-group is-open="nationalData.ownmaps_open" ng-if="nationalData.products.length > 0">
                                <uib-accordion-heading>
                                    Products
                                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': nationalData.ownmaps_open, 'glyphicon-chevron-right': !nationalData.ownmaps_open}"></i>
                                </uib-accordion-heading>
                                <uib-accordion close-others="false">
                                    <ul class="items products" style="padding-left:0;">
                                        <uib-accordion close-others="false">
                                            <div uib-accordion-group ng-repeat="product in nationalData.products"  heading="{{product.name}}" is-open="product.open">
                                                <uib-accordion-heading ng-click="tracking.trackProduct(product.name, product.open);">
                                                    <span class="project">[SWOS]</span> {{product.name}}
                                                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': product.open, 'glyphicon-chevron-right': !product.open}"></i>
                                                </uib-accordion-heading>
                                                <div class="options">
                                                    <p ng-text-truncate='product.description' ng-tt-chars-threshold="200"></p>
                                                    <div class="products_datasets">
                                                        <strong>Layers:</strong>
                                                        <div class="select" ng-if="product.layers.length > 0">
                                                            <div ng-repeat="layer in product.layers" id="layer_vis_div_{{layer.id}}">
                                                                <input ng-if="wetlands.layerIdMap[layer.id] === undefined" type="checkbox" ng-click="wetlands.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}" />
                                                                <input ng-if="wetlands.layerIdMap[layer.id]" type="checkbox" ng-click="wetlands.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}" checked="checked" />
                                                                <label for="layer_vis_{{layer.id}}"> {{layer.alternate_title}}</label>
                                                                <swos-layer-controls ng-if="wetlands.layers[wetlands.layerIdMap[layer.id]]" layer-hash="{{ wetlands.layerIdMap[layer.id] }}"></swos-layer-controls>
                                                            </div>
                                                        </div>
                                                        <div class="select" ng-if="product.layers.length == 0">
                                                            No datasets available.
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </uib-accordion>
                                    </ul>
                                </uib-accordion>
                            </div>

                            <div uib-accordion-group is-open="nationalData.wetlands_open" ng-if="nationalData.wetlands.length > 0">
                                <uib-accordion-heading>
                                    Wetlands
                                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': nationalData.wetlands_open, 'glyphicon-chevron-right': !nationalData.wetlands_open}"></i>
                                </uib-accordion-heading>
                                <uib-accordion close-others="false">
                                    <div uib-accordion-group ng-repeat="wetland in nationalData.wetlands">
                                        <uib-accordion-heading>
                                            {{wetland.name}}
                                            <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': nationalData.open_global_maps, 'glyphicon-chevron-right': !nationalData.open_global_maps}"></i>
                                        </uib-accordion-heading>
                                        <div class="properties">
                                            <table>
                                                <tr>
                                                    <th valign="top">Description:</th>
                                                    <td valign="top">{{wetland.description}}</td>
                                                </tr>
                                                <tr>
                                                    <th>Scale:</th>
                                                    <td>{{wetland.geo_scale}}</td>
                                                </tr>
                                                <tr>
                                                    <th>Type:</th>
                                                    <td>{{wetland.site_type}} | {{wetland.wetland_type}}</td>
                                                </tr>
                                                <tr>
                                                    <th valign="top">Ecoregion:</th>
                                                    <td valign="top">{{wetland.ecoregion}}</td>
                                                </tr>
                                                <tr>
                                                    <th>Size:</th>
                                                    <td>{{nationalData.formatValue(wetland.size)}} ha</td>
                                                </tr>
                                                <tr ng-if="wetland.products.length > 0">
                                                    <th valign="top">Products:</th>
                                                    <td valign="top">{{wetland.products.join(', ')}}</td>
                                                </tr>
                                            </table>
                                            <br/>
                                            <a href="javascript:;" ng-click="nationalData.loadWetland(wetland.id);">&#10095; Show all data from this wetland</a>

                                        </div>

                                    </div>
                                </uib-accordion>
                            </div>

                            <div uib-accordion-group is-open="nationalData.statistics_open" ng-if="nationalData.lulc_layers.length > 0">
                                <uib-accordion-heading>
                                    National wetland statistics
                                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': nationalData.statistics_open, 'glyphicon-chevron-right': !nationalData.statistics_open}"></i>
                                </uib-accordion-heading>
                                Please specify classification legend:
                                <select id="statistics_clc" name="statistics_clc" class="selectpicker" name="clc_type" ng-model="nationalData.clc_type"  ng-options="objMake as objMake.legend for objMake in nationalData.lulc_layers">

                                </select><br /><br/>
                                Please specify year of data:
                                <select id="statistics_year" name="statistics_year" class="selectpicker" name="year" ng-model="nationalData.year" ng-options="date for date in nationalData.clc_type.dates">

                                </select><br/><br/>
                                <button class="btn btn-primary" ng-click="nationalData.showStatistics();">Show statistics</button>
                            </div>

                            <div uib-accordion-group is-open="nationalData.maps_open" ng-if="nationalData.layers.length > 0">
                                <uib-accordion-heading>
                                    External national maps & layers
                                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': nationalData.maps_open, 'glyphicon-chevron-right': !nationalData.maps_open}"></i>
                                </uib-accordion-heading>
                                <uib-accordion close-others="false">
                                    <div uib-accordion-group  is-open="externaldb.open2" ng-repeat="externaldb in nationalData.layers">
                                        <uib-accordion-heading>
                                            <div id=externaldb_{{externaldb.ext_db_id}}" ng-if="externaldb.layers.length > 0" class="flaticon-layers"> {{externaldb.name}}
                                                <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': externaldb.open2, 'glyphicon-chevron-right': !externaldb.open2}"></i></div>
                                            <div id="externaldb_{{externaldb.ext_db_id}}" ng-if="!externaldb.layers.length" class="flaticon-internet"> {{externaldb.name}}
                                                <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': externaldb.open2, 'glyphicon-chevron-right': !externaldb.open2}"></i></div>
                                        </uib-accordion-heading>
                                        <p ng-text-truncate='externaldb.description' ng-tt-chars-threshold="200"></p>
                                        <div ng-if="externaldb.provided_info"><strong>Provided data:</strong><p ng-text-truncate='externaldb.provided_info' ng-tt-chars-threshold="200"></p></div>
                                        <strong>Link:</strong>
                                        <div><p><a href="{{ externaldb.online_link }}" target="_blank">{{externaldb.online_link}}</a> <span ng-if="externaldb.language != 'en'">({{ externaldb.language }})</span></p></div>
                                        <div class="geoss-btn" ng-if="externaldb.geoss_datasource_id">
                                            <button class="btn btn-default btn-primary" style="cursor:pointer" ng-click="nationalData.externalDBSearchGeoss(externaldb.geoss_datasource_id, 'OVERLAPS')">Search with GEOSS</button>
                                        </div>
                                        <div class="select" ng-if="externaldb.layers.length > 0">
                                            <strong>Layers:</strong>
                                            <div ng-repeat="layer in externaldb.layers"
                                                 ng-controller="MapCurrentLayersCtrl as mcl" id="layer_vis_div_{{layer.id}}">
                                                <input ng-if="wetlands.layerIdMap[layer.id] === undefined" type="checkbox" ng-click="wetlands.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}"/>
                                                <input ng-if="wetlands.layerIdMap[layer.id]" type="checkbox" ng-click="wetlands.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}" checked="checked"/>
                                                <label for="layer_vis_{{layer.id}}"> {{layer.alternate_title}}</label>
                                                <swos-layer-controls ng-if="wetlands.layers[wetlands.layerIdMap[layer.id]]" layer-hash="{{ wetlands.layerIdMap[layer.id] }}"></swos-layer-controls>
                                            </div>
                                        </div>
                                    </div>
                                </uib-accordion>
                            </div>
                            <div uib-accordion-group is-open="nationalData.databases_open" ng-if="nationalData.databases.length > 0">
                                <uib-accordion-heading>
                                    National databases
                                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': nationalData.databases_open, 'glyphicon-chevron-right': !nationalData.databases_open}"></i>
                                </uib-accordion-heading>
                                <uib-accordion close-others="false">
                                    <div uib-accordion-group  is-open="externaldb.open2" ng-repeat="externaldb in nationalData.databases">
                                        <uib-accordion-heading>
                                            <div id=externaldb_{{externaldb.ext_db_id}}" ng-if="externaldb.layers.length > 0" class="flaticon-layers"> {{externaldb.name}}
                                                <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': externaldb.open2, 'glyphicon-chevron-right': !externaldb.open2}"></i></div>
                                            <div id="externaldb_{{externaldb.ext_db_id}}" ng-if="!externaldb.layers.length" class="flaticon-internet"> {{externaldb.name}}
                                                <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': externaldb.open2, 'glyphicon-chevron-right': !externaldb.open2}"></i></div>
                                        </uib-accordion-heading>
                                        <p ng-text-truncate='externaldb.description' ng-tt-chars-threshold="200"></p>
                                        <div ng-if="externaldb.provided_info"><strong>Provided data:</strong><p ng-text-truncate='externaldb.provided_info' ng-tt-chars-threshold="200"></p></div>
                                        <strong>Link:</strong>
                                        <div><p><a href="{{ externaldb.online_link }}" target="_blank">{{externaldb.online_link}}</a> <span ng-if="externaldb.language != 'en'">({{ externaldb.language }})</span></p></div>
                                        <div class="geoss-btn" ng-if="externaldb.geoss_datasource_id">
                                            <button class="btn btn-default btn-primary" style="cursor:pointer" ng-click="nationalData.externalDBSearchGeoss(externaldb.geoss_datasource_id, 'OVERLAPS')">Search with GEOSS</button>
                                        </div>
                                        <div class="select" ng-if="externaldb.layers.length > 0">
                                            <strong>Layers:</strong>
                                            <div ng-repeat="layer in externaldb.layers"
                                                 ng-controller="MapCurrentLayersCtrl as mcl" id="layer_vis_div_{{layer.id}}">
                                                <input ng-if="wetlands.layerIdMap[layer.id] === undefined" type="checkbox" ng-click="wetlands.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}"/>
                                                <input ng-if="wetlands.layerIdMap[layer.id]" type="checkbox" ng-click="wetlands.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}" checked="checked"/>
                                                <label for="layer_vis_{{layer.id}}"> {{layer.alternate_title}}</label>
                                                <swos-layer-controls ng-if="wetlands.layers[wetlands.layerIdMap[layer.id]]" layer-hash="{{ wetlands.layerIdMap[layer.id] }}"></swos-layer-controls>
                                            </div>
                                        </div>
                                    </div>
                                </uib-accordion>
                            </div>
                            <div uib-accordion-group is-open="nationalData.geoss_open">
                                <uib-accordion-heading>
                                    Search within GEOSS
                                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': nationalData.geoss_open, 'glyphicon-chevron-right': !nationalData.geoss_open}"></i>
                                </uib-accordion-heading>
                                <form>
                                    <label style="margin-left:11px;" for="national_geoss_name">Filter by text: </label><br/>
                                    <input name="national_geoss_name" id="national_geoss_name" type="text" ng-model="nationalData.geoss_text" />
                                    <br /><br/>

                                    <label style="margin-left:11px;" for="national_geoss_select">Filter by data source: </label><br/>
                                    <select id="national_geoss_select" name="national_geoss_select" class="selectpicker" ng-model="nationalData.geoss_source" multiple data-live-search="true" title="All - To filter please select">
                                        <optgroup label="National" ng-if="nationalData.geoss.national.length > 0">
                                            <option ng-repeat="geoss in nationalData.geoss.national" value="{{geoss.geoss_id}}">{{geoss.name}}</option>
                                        </optgroup>
                                        <optgroup label="Continental" ng-if="nationalData.geoss.continental.length > 0">
                                            <option ng-repeat="geoss in nationalData.geoss.continental" value="{{geoss.geoss_id}}">{{geoss.name}}</option>
                                        </optgroup>
                                        <optgroup label="Global" ng-if="nationalData.geoss.global.length > 0">
                                            <option ng-repeat="geoss in nationalData.geoss.global" value="{{geoss.geoss_id}}">{{geoss.name}}</option>
                                        </optgroup>
                                    </select>
                                    <br /><br/>
                                    <button ng-click="nationalData.externalDBSearchGeoss(null, 'CONTAINS')" class="btn btn-primary" style="cursor:pointer;">Search</button>
                                    <div style="font-size:0.8em;font-style:italic;margin-top:5px;">Please note: Only results within the bounding box of the selected country are returned.</div>
                                </form>
                            </div>
                        </uib-accordion>

                    </div>

                    <div role="tabpanel" class="tab-pane continental_data" id="continental" ng-controller="ContinentalDataCtrl as continentalData">

                        <div class="btn-group" uib-dropdown is-open="status.isopen" style="width:100%">
                          <button id="continent-selection" type="button" class="btn btn-primary btn-block" uib-dropdown-toggle ng-disabled="disabled" style="width:100%;background-color:#336a5c;">
                            <span ng-if="continentalData.selectedContinent == ''">Please select a continent</span>
                            <span ng-if="continentalData.selectedContinent != ''">Continent: {{continentalData.selectedContinent}}</span>
                            <span class="caret" style="margin-top:0;"></span>
                          </button>
                          <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button" style="width:100%;text-align:center;">
                            <li role="menuitem"><a href="#continental/{{continent}}" ng-click="continentalData.selectContinent(continent)" ng-repeat="continent in continentalData.continents">{{continent}}</a></li>
                          </ul>
                        </div>

                        <uib-accordion close-others="false" ng-if="continentalData.selectedContinent != ''">
                            <div uib-accordion-group is-open="continentalData.maps_open" ng-if="continentalData.layers.length > 0">
                                <uib-accordion-heading>
                                    Maps & layers
                                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': continentalData.maps_open, 'glyphicon-chevron-right': !continentalData.maps_open}"></i>
                                </uib-accordion-heading>
                                <uib-accordion close-others="false">
                                    <div uib-accordion-group  is-open="externaldb.open2" ng-repeat="externaldb in continentalData.layers">
                                        <uib-accordion-heading>
                                            <div id=externaldb_{{externaldb.ext_db_id}}" ng-if="externaldb.layers.length > 0" class="flaticon-layers"> {{externaldb.name}}
                                                <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': externaldb.open2, 'glyphicon-chevron-right': !externaldb.open2}"></i></div>
                                            <div id="externaldb_{{externaldb.ext_db_id}}" ng-if="!externaldb.layers.length" class="flaticon-internet"> {{externaldb.name}}
                                                <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': externaldb.open2, 'glyphicon-chevron-right': !externaldb.open2}"></i></div>
                                        </uib-accordion-heading>
                                        <p ng-text-truncate='externaldb.description' ng-tt-chars-threshold="200"></p>
                                        <div ng-if="externaldb.provided_info"><strong>Provided data:</strong><p ng-text-truncate='externaldb.provided_info' ng-tt-chars-threshold="200"></p></div>
                                        <strong>Link:</strong>
                                        <div><p><a href="{{ externaldb.online_link }}" target="_blank">{{externaldb.online_link}}</a> <span ng-if="externaldb.language != 'en'">({{ externaldb.language }})</span></p></div>
                                        <div class="geoss-btn" ng-if="externaldb.geoss_datasource_id">
                                            <button class="btn btn-default btn-primary" style="cursor:pointer" ng-click="continentelData.externalDBSearchGeoss(externaldb.geoss_datasource_id, 'OVERLAPS')">Search with GEOSS</button>
                                        </div>
                                        <div class="select" ng-if="externaldb.layers.length > 0">
                                            <strong>Layers:</strong>
                                            <div ng-repeat="layer in externaldb.layers"
                                                 ng-controller="MapCurrentLayersCtrl as mcl" id="layer_vis_div_{{layer.id}}">
                                                <input ng-if="wetlands.layerIdMap[layer.id] === undefined" type="checkbox" ng-click="wetlands.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}"/>
                                                <input ng-if="wetlands.layerIdMap[layer.id]" type="checkbox" ng-click="wetlands.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}" checked="checked"/>
                                                <label for="layer_vis_{{layer.id}}"> {{layer.alternate_title}}</label>
                                                <swos-layer-controls ng-if="wetlands.layers[wetlands.layerIdMap[layer.id]]" layer-hash="{{ wetlands.layerIdMap[layer.id] }}"></swos-layer-controls>
                                            </div>
                                        </div>
                                    </div>
                                </uib-accordion>
                            </div>
                            <div uib-accordion-group is-open="continentalData.databases_open" ng-if="continentalData.databases.length > 0">
                                <uib-accordion-heading>
                                    Databases
                                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': continentalData.databases_open, 'glyphicon-chevron-right': !continentalData.databases_open}"></i>
                                </uib-accordion-heading>
                                <uib-accordion close-others="false">
                                    <div uib-accordion-group  is-open="externaldb.open2" ng-repeat="externaldb in continentalData.databases">
                                        <uib-accordion-heading>
                                            <div id=externaldb_{{externaldb.ext_db_id}}" ng-if="externaldb.layers.length > 0" class="flaticon-layers"> {{externaldb.name}}
                                                <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': externaldb.open2, 'glyphicon-chevron-right': !externaldb.open2}"></i></div>
                                            <div id="externaldb_{{externaldb.ext_db_id}}" ng-if="!externaldb.layers.length" class="flaticon-internet"> {{externaldb.name}}
                                                <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': externaldb.open2, 'glyphicon-chevron-right': !externaldb.open2}"></i></div>
                                        </uib-accordion-heading>
                                        <p ng-text-truncate='externaldb.description' ng-tt-chars-threshold="200"></p>
                                        <div ng-if="externaldb.provided_info"><strong>Provided data:</strong><p ng-text-truncate='externaldb.provided_info' ng-tt-chars-threshold="200"></p></div>
                                        <strong>Link:</strong>
                                        <div><p><a href="{{ externaldb.online_link }}" target="_blank">{{externaldb.online_link}}</a> <span ng-if="externaldb.language != 'en'">({{ externaldb.language }})</span></p></div>
                                        <div class="geoss-btn" ng-if="externaldb.geoss_datasource_id">
                                            <button class="btn btn-default btn-primary" style="cursor:pointer" ng-click="continentelData.externalDBSearchGeoss(externaldb.geoss_datasource_id, 'OVERLAPS')">Search with GEOSS</button>
                                        </div>
                                        <div class="select" ng-if="externaldb.layers.length > 0">
                                            <strong>Layers:</strong>
                                            <div ng-repeat="layer in externaldb.layers"
                                                 ng-controller="MapCurrentLayersCtrl as mcl" id="layer_vis_div_{{layer.id}}">
                                                <input ng-if="wetlands.layerIdMap[layer.id] === undefined" type="checkbox" ng-click="wetlands.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}"/>
                                                <input ng-if="wetlands.layerIdMap[layer.id]" type="checkbox" ng-click="wetlands.addLayerToMap(layer, $event);" id="layer_vis_{{layer.id}}" checked="checked"/>
                                                <label for="layer_vis_{{layer.id}}"> {{layer.alternate_title}}</label>
                                                <swos-layer-controls ng-if="wetlands.layers[wetlands.layerIdMap[layer.id]]" layer-hash="{{ wetlands.layerIdMap[layer.id] }}"></swos-layer-controls>
                                            </div>
                                        </div>
                                    </div>
                                </uib-accordion>
                            </div>
                            <div uib-accordion-group is-open="continentalData.geoss_open">
                                <uib-accordion-heading>
                                    Search within GEOSS
                                    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': continentalData.geoss_open, 'glyphicon-chevron-right': !continentalData.geoss_open}"></i>
                                </uib-accordion-heading>
                                <form>
                                    <label style="margin-left:11px;" for="continental_geoss_name">Filter by text: </label><br/>
                                    <input name="continental_geoss_name" id="continental_geoss_name" type="text" ng-model="continentalData.geoss_text" />
                                    <br /><br/>

                                    <label style="margin-left:11px;" for="continental_geoss_select">Filter by data source: </label><br/>
                                    <select id="continental_geoss_select" name="continental_geoss_select" class="selectpicker" ng-model="continentalData.geoss_source" multiple data-live-search="true" title="All - To filter please select">
                                        <optgroup label="Continental" ng-if="continentalData.geoss.continental.length > 0">
                                            <option ng-repeat="geoss in continentalData.geoss.continental" value="{{geoss.geoss_id}}">{{geoss.name}}</option>
                                        </optgroup>
                                        <optgroup label="Global" ng-if="continentalData.geoss.global.length > 0">
                                            <option ng-repeat="geoss in continentalData.geoss.global" value="{{geoss.geoss_id}}">{{geoss.name}}</option>
                                        </optgroup>
                                    </select>
                                    <br /><br/>
                                    <button ng-click="continentalData.externalDBSearchGeoss(null, 'CONTAINS')" class="btn btn-primary" style="cursor:pointer;">Search</button>
                                    <div style="font-size:0.8em;font-style:italic;margin-top:5px;">Please note: Only results within the bounding box of the selected continent are returned.</div>
                                </form>
                            </div>
                        </uib-accordion>

                    </div>

                    <div role="tabpanel" class="tab-pane global_data" id="global">



                    </div>

                </div>
            </div>
            {% endverbatim %}

        </div>
    </div>

    <div style="display:none">
        <div id="popup"></div>
        <div id="stationPopup"></div>
        <div id="storylinePopup"></div>
    </div>

    <div id="info_text" style="display:none;">
        <div class="modal-header">
            <h1>Info</h1>
        </div>
        <div class="modal-body">
            <div class="text window_info">{{html_info|safe|linebreaks}}</div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" ng-click="mi.close()">
                Close
            </button>
        </div>
    </div>

    <!-- Geoss Search Widget popup container -->
    <!-- 'geoss' class is needed -->
    <div id="geoss-popup" style="display:none;">
        <div modal-draggable class="modal-header">
            <h1>Metadata</h1>
        </div>
        <div class="modal-body" style="padding: 0;">
            <div class="text popups-container geoss"></div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" ng-click="mi.close()">
                Close
            </button>
        </div>
    </div>

    {% assets "swosVendorJsBundle" %}
    <script src="{{ ASSET_URL }}" type="text/javascript"></script>
    {% endassets %}

    {% assets "swosAppJsBundle" %}
    <script src="{{ ASSET_URL }}" type="text/javascript"></script>
    {% endassets %}

    <div ng-view></div>

</body>
</html>
